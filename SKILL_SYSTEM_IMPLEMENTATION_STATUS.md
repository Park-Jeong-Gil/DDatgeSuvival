# 스킬 시스템 구현 완료 현황

## 📋 구현 개요

로그라이크 스킬 시스템이 완전히 구현되었습니다. 15개 스킬이 모두 구현되었으며, 자동 발동 시스템, 구매 시스템, UI가 모두 작동합니다.

## ✅ 완료된 Phase

### Phase 1: 데이터 및 API 레이어 ✅
- [x] 타입 정의 (`src/types/skill.ts`)
- [x] 스킬 데이터 (`src/lib/phaser/data/skillData.ts`) - 15개 스킬 정의
- [x] 데이터베이스 스키마 업데이트 (`src/types/supabase.ts`)
  - `total_accumulated_score`: 누적 스코어
  - `currency`: 게임 화폐 (1000점 = 100원)
  - `unlocked_skills`: 언락된 스킬 ID 배열
  - `purchased_skills`: 구매한 스킬 ID 배열
- [x] API 라우트
  - `src/app/api/scores/route.ts`: 누적 스코어 계산 및 스킬 언락
  - `src/app/api/skills/route.ts`: 스킬 구매 처리

### Phase 2: UI 레이어 ✅
- [x] 게임 스토어 확장 (`src/store/gameStore.ts`)
  - `selectedSkills` 상태 추가
- [x] 스킬 선택 UI (`src/components/game/SkillSelectTab.tsx`)
  - 구매한 스킬 목록 표시
  - 최대 3개 선택 가능
- [x] 스킬 카드 (`src/components/game/SkillCard.tsx`)
  - 스킬 정보 표시, 구매/선택 기능
- [x] 코스튬 모달 수정 (`src/components/game/CostumeSelectModal.tsx`)
  - 탭 UI 추가: "코스튬" / "스킬"
  - 화폐 잔액 표시
- [x] 메인 페이지 (`src/app/page.tsx`)
  - 스킬 데이터 로딩
  - 디버그 모드 지원 (localStorage.DEBUG_MODE)

### Phase 3: 게임 시스템 - 패시브 스킬 ✅
- [x] SkillManager 기본 구조 (`src/lib/phaser/systems/SkillManager.ts`)
- [x] 패시브 스킬 구현:
  1. **스케이트보드** - 속도 +15%
  2. **포만감 우유** - 공복 감소 -20%
  3. **경험치 버섯** - 경험치 +15%
  4. **천적 탐지기** - 포식자 하이라이트
  5. **왕관** - 아이템 스폰 빈도 +30%
  6. **네잎클로버** - 레어리티 확률 개선 +20%
- [x] 시작 시 스킬:
  7. **곡괭이** - 게임 시작 시 바위 제거
  8. **도끼** - 게임 시작 시 나무 제거
- [x] GameScene 통합 (`src/lib/phaser/scenes/GameScene.ts`)
- [x] 기존 시스템 연동
  - HungerSystem: 공복 배율 적용
  - LevelSystem: 경험치 배율 적용
  - ItemManager: 스폰 빈도, 레어리티 적용
  - NPCManager: 포식자 하이라이트

### Phase 4: 게임 시스템 - 액티브 스킬 (간단) ✅
9. **비눗방울** (쿨타임 30초)
   - 15초간 포식자 감지 거리 반감

10. **리볼버** (쿨타임 30초)
    - 화면 내 무작위 먹이 1마리 제거

11. **거미줄** (3회 충전, 각 10초)
    - 플레이어 근처 200px 도망가는 먹이 2초 정지
    - 충전 시스템 구현 완료

12. **번개** (쿨타임 60초)
    - 모든 NPC 5초 정지

### Phase 5: 게임 시스템 - 오브 스킬 (복잡) ✅
- [x] OrbitingObject 클래스 (`src/lib/phaser/entities/OrbitingObject.ts`)
  - 플레이어 주변 원형 궤도 회전
  - 반지름 60px, 회전 속도 120도/초
  - 1회용 충돌 시스템

- [x] 오브 스킬 구현:
  13. **파이어볼** (쿨타임 45초, 각도 0°)
      - 포식자 충돌 시 3초 기절

  14. **아이스볼** (쿨타임 45초, 각도 120°)
      - 포식자 충돌 시 3초 기절 (현재 slow는 stun으로 대체)

  15. **돌멩이** (쿨타임 45초, 각도 240°)
      - 포식자 충돌 시 100px 넉백

- [x] 충돌 처리
  - Phaser.physics.add.overlap 사용
  - 포식자만 충돌 처리 (플레이어 레벨보다 높은 NPC)
  - 파티클 효과

- [x] 스프라이트 프리로드 (`src/lib/phaser/scenes/PreloadScene.ts`)
  - `skill_fireball`, `skill_iceball`, `skill_stone` 이미지 로드
  - 모든 스킬 스프라이트 파일 확인 완료 (15개)

### Phase 6: 자동 발동 시스템 ✅
- [x] 쿨타임 관리 (`SkillManager.ts`)
  - `cooldowns` Map으로 각 스킬 쿨타임 추적
  - `update(delta)` 메서드에서 자동 감소
  - 쿨타임 0 도달 시 자동 발동

- [x] 충전 시스템 (거미줄용)
  - `charges` Map: 현재 충전 수
  - `chargeTimers` Map: 충전 타이머
  - 10초마다 1회 충전 (최대 3회)

- [x] 게임 시작 시 초기화
  - 모든 액티브 스킬: 5초 후 첫 발동
  - 거미줄: 3회 충전 상태로 시작

- [x] 오브 업데이트 루프
  - `activeOrbs` 배열로 관리
  - 매 프레임 `orb.update(delta)` 호출
  - 사용된 오브 자동 제거

### Phase 7: 스킬 구매 시스템 ✅
- [x] 스킬 구매 API (`src/app/api/skills/route.ts`)
  - 언락 확인
  - 중복 구매 방지
  - 화폐 잔액 확인
  - 화폐 차감 및 구매 목록 업데이트

- [x] UI 구매 로직 (`SkillSelectTab.tsx`)
  - 구매 버튼 클릭 → API 호출
  - 성공/실패 토스트 메시지
  - 화폐 잔액 실시간 업데이트

---

## 🎮 게임 플레이 테스트 체크리스트

### 기본 기능
- [ ] 게임 플레이 후 누적 스코어가 올바르게 계산되는가?
- [ ] 화폐가 올바르게 변환되는가? (1000 스코어 = 100원)
- [ ] 스킬이 누적 스코어에 따라 언락되는가?

### 구매 시스템
- [ ] 스킬 구매 시 화폐가 차감되는가?
- [ ] 구매한 스킬이 선택 가능 목록에 나타나는가?
- [ ] 최대 3개 선택 제한이 작동하는가?
- [ ] 화폐 부족 시 구매가 차단되는가?
- [ ] 이미 구매한 스킬 재구매가 차단되는가?

### 게임 내 스킬 적용
- [ ] 선택한 스킬이 게임에 적용되는가?
- [ ] 패시브 스킬 효과가 즉시 적용되는가?
  - [ ] 스케이트보드: 플레이어 속도 증가
  - [ ] 포만감 우유: 공복 감소 속도 저하
  - [ ] 경험치 버섯: 경험치 획득량 증가
  - [ ] 천적 탐지기: 포식자 빨간색 하이라이트
  - [ ] 왕관: 아이템 스폰 빈도 증가
  - [ ] 네잎클로버: 레어 아이템 출현율 증가
- [ ] 시작 시 스킬이 게임 시작 시 실행되는가?
  - [ ] 곡괭이: 바위 제거
  - [ ] 도끼: 나무 제거

### 액티브 스킬 (자동 발동)
- [ ] 게임 시작 5초 후 첫 스킬 자동 발동
- [ ] 쿨타임에 맞춰 반복 발동
  - [ ] 비눗방울 (30초): 포식자 감지 거리 반감
  - [ ] 리볼버 (30초): 화면 내 먹이 제거
  - [ ] 거미줄 (충전): 근처 먹이 정지
  - [ ] 번개 (60초): 모든 NPC 정지

### 오브 스킬
- [ ] 오브가 플레이어 주변을 부드럽게 도는가?
  - [ ] 파이어볼 (0°)
  - [ ] 아이스볼 (120°)
  - [ ] 돌멩이 (240°)
- [ ] 오브가 화면에 이미지로 표시되는가?
- [ ] 오브가 포식자와 충돌 시 효과 발동
  - [ ] 파이어볼: 3초 기절
  - [ ] 아이스볼: 3초 기절
  - [ ] 돌멩이: 100px 넉백
- [ ] 충돌 후 오브가 소멸하는가?
- [ ] 파티클 효과가 나타나는가?
- [ ] 포식자가 아닌 먹이에는 효과가 없는가?

### 디버그 모드
- [ ] `localStorage.setItem('DEBUG_MODE', 'true')` 설정 후
- [ ] 모든 15개 스킬이 언락되는가?
- [ ] 모든 스킬이 구매된 상태로 표시되는가?
- [ ] 화폐가 999,999로 설정되는가?
- [ ] 스킬 3개 선택 후 게임 시작 가능한가?

---

## 🐛 알려진 이슈 및 개선 사항

### 현재 제한 사항
1. **아이스볼 효과**: 현재 "감속"이 아닌 "기절"로 구현됨
   - NPC 클래스에 `slowMultiplier` 속성이 없어 `stunUntil`로 대체
   - 향후 NPC에 감속 시스템을 추가하면 개선 가능

2. **충전 시스템 UI**: 거미줄 충전 수가 게임 UI에 표시되지 않음
   - 현재는 콘솔 로그로만 확인 가능
   - HUD에 충전 표시 추가 가능 (옵션)

3. **쿨타임 표시 UI**: 스킬 쿨타임이 게임 UI에 표시되지 않음
   - 자동 발동 시스템이므로 필수는 아님
   - 원한다면 `SkillCooldownDisplay.tsx` 컴포넌트 추가 가능

### 향후 개선 가능 항목
- [ ] NPC에 감속 시스템 추가 (아이스볼 차별화)
- [ ] 거미줄 충전 수 HUD 표시
- [ ] 스킬 쿨타임 진행 바 (옵션)
- [ ] 스킬 발동 시 시각/청각 피드백 강화
- [ ] 밸런스 조정 (쿨타임, 효과 수치, 가격)

---

## 🎯 밸런스 조정 포인트

### 현재 설정값
| 스킬 | 가격 | 언락 스코어 | 쿨타임 | 효과 |
|------|------|------------|--------|------|
| 돌멩이 | 450 | 4,000 | 45초 | 100px 넉백 |
| 파이어볼 | 500 | 5,000 | 45초 | 3초 기절 |
| 아이스볼 | 500 | 6,000 | 45초 | 3초 기절 |
| 거미줄 | 600 | 8,000 | 10초/충전 | 2초 정지 (3충전) |
| 비눗방울 | 700 | 10,000 | 30초 | 15초 감지 반감 |
| 곡괭이 | 800 | 11,000 | - | 바위 제거 |
| 도끼 | 800 | 11,000 | - | 나무 제거 |
| 리볼버 | 800 | 12,000 | 30초 | 먹이 1마리 제거 |
| 천적 탐지기 | 900 | 13,000 | - | 포식자 표시 |
| 스케이트보드 | 1,000 | 15,000 | - | 속도 +15% |
| 포만감 우유 | 1,200 | 18,000 | - | 공복 -20% |
| 경험치 버섯 | 1,500 | 20,000 | - | 경험치 +15% |
| 왕관 | 1,800 | 25,000 | - | 아이템 +30% |
| 네잎클로버 | 2,000 | 30,000 | - | 레어리티 +20% |
| 번개 | 2,500 | 35,000 | 60초 | 5초 전체 정지 |

### 테스트 후 조정 고려 사항
- 오브 스킬 쿨타임이 너무 길거나 짧은가?
- 거미줄 충전 속도가 적절한가?
- 패시브 스킬 효과가 체감되는가?
- 가격과 언락 스코어가 게임 진행과 맞는가?

---

## 📂 핵심 파일 위치

### 데이터 및 타입
- `src/types/skill.ts` - SkillData 인터페이스
- `src/lib/phaser/data/skillData.ts` - 15개 스킬 정의
- `src/types/supabase.ts` - 데이터베이스 타입

### API
- `src/app/api/scores/route.ts` - 누적 스코어/화폐 계산
- `src/app/api/skills/route.ts` - 스킬 구매

### UI
- `src/components/game/CostumeSelectModal.tsx` - 메인 모달 (탭 UI)
- `src/components/game/SkillSelectTab.tsx` - 스킬 선택 탭
- `src/components/game/SkillCard.tsx` - 개별 스킬 카드
- `src/app/page.tsx` - 메인 페이지 (스킬 로딩)

### 게임 시스템
- `src/lib/phaser/systems/SkillManager.ts` - 스킬 관리 시스템
- `src/lib/phaser/entities/OrbitingObject.ts` - 오브 엔티티
- `src/lib/phaser/scenes/GameScene.ts` - 게임 씬 (통합)
- `src/lib/phaser/scenes/PreloadScene.ts` - 에셋 프리로드

### 상태 관리
- `src/store/gameStore.ts` - 게임 상태 (selectedSkills)

---

## 🚀 다음 단계

1. **테스트 실행**
   - 위의 체크리스트를 따라 모든 기능 테스트
   - 디버그 모드로 빠른 테스트 진행

2. **밸런스 조정**
   - 실제 플레이 데이터 수집
   - 스킬 효과, 쿨타임, 가격 조정

3. **UI/UX 개선** (옵션)
   - 충전 수 표시
   - 쿨타임 진행 바
   - 스킬 발동 피드백 강화

4. **버그 수정**
   - 테스트 중 발견된 버그 수정
   - 엣지 케이스 처리

---

## 📝 디버그 모드 사용법

```javascript
// 브라우저 콘솔에서 실행
localStorage.setItem('DEBUG_MODE', 'true');

// 디버그 모드 해제
localStorage.removeItem('DEBUG_MODE');

// 현재 설정 확인
localStorage.getItem('DEBUG_MODE');
```

디버그 모드 활성화 시:
- 모든 15개 스킬 자동 언락
- 모든 스킬 자동 구매
- 화폐 999,999원 지급
- 게임 시작 시 원하는 스킬 3개 선택 가능

---

**구현 완료일**: 2026-02-09
**빌드 상태**: ✅ 성공
**다음 작업**: Phase 8 - 테스트 및 밸런싱
